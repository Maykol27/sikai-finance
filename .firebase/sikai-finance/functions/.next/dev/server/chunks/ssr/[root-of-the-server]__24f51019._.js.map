{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/utils/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport function createClient() {\r\n    return createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACZ,OAAO,IAAA,iMAAmB;AAI9B"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/CategoryManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { Plus, Trash2, ChevronRight, ChevronDown, Folder, Save, X, Sparkles } from \"lucide-react\";\r\nimport { clsx } from \"clsx\";\r\n\r\ntype Category = {\r\n    id: string;\r\n    name: string;\r\n    type: 'income' | 'expense';\r\n    parent_id: string | null;\r\n    subcategories?: Category[];\r\n};\r\n\r\nexport default function CategoryManager({ userId, isOpen, onClose }: { userId: string, isOpen: boolean, onClose: () => void }) {\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [newCatName, setNewCatName] = useState(\"\");\r\n    const [selectedParent, setSelectedParent] = useState<string | null>(null);\r\n    const [expanded, setExpanded] = useState<Record<string, boolean>>({});\r\n\r\n    const supabase = createClient();\r\n\r\n    useEffect(() => {\r\n        if (isOpen) fetchCategories();\r\n    }, [isOpen]);\r\n\r\n    const fetchCategories = async () => {\r\n        setLoading(true);\r\n        const { data } = await supabase.from('categories').select('*').eq('user_id', userId).order('name');\r\n\r\n        if (data) {\r\n            const tree: Category[] = [];\r\n            const map: Record<string, Category> = {};\r\n\r\n            // Initialize map with subcategories array\r\n            data.forEach((c: any) => {\r\n                map[c.id] = { ...c, subcategories: [] };\r\n            });\r\n\r\n            // Build tree\r\n            data.forEach((c: any) => {\r\n                if (c.parent_id && map[c.parent_id]) {\r\n                    map[c.parent_id].subcategories?.push(map[c.id]);\r\n                } else if (!c.parent_id) { // Only add to root if no parent\r\n                    tree.push(map[c.id]);\r\n                }\r\n            });\r\n\r\n            setCategories(tree);\r\n\r\n            // Auto-expand all for better visibility initially\r\n            const initialExpanded: Record<string, boolean> = {};\r\n            tree.forEach(c => initialExpanded[c.id] = true);\r\n            setExpanded(prev => ({ ...prev, ...initialExpanded }));\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleAdd = async () => {\r\n        if (!newCatName.trim()) return;\r\n\r\n        const { error } = await supabase.from('categories').insert({\r\n            user_id: userId,\r\n            name: newCatName,\r\n            type: 'expense',\r\n            parent_id: selectedParent\r\n        });\r\n\r\n        if (!error) {\r\n            setNewCatName(\"\");\r\n            fetchCategories();\r\n        }\r\n    };\r\n\r\n    const seedDefaults = async () => {\r\n        setLoading(true);\r\n        const defaults = [\r\n            { name: \"Ingresos\", type: \"income\", subs: [\"Salario\", \"Freelance\", \"Inversiones\"] },\r\n            { name: \"Vivienda\", type: \"expense\", subs: [\"Alquiler\", \"Servicios\", \"Mantenimiento\"] },\r\n            { name: \"Comida\", type: \"expense\", subs: [\"Supermercado\", \"Restaurantes\", \"Delivery\"] },\r\n            { name: \"Transporte\", type: \"expense\", subs: [\"Gasolina\", \"Transporte Público\", \"Mantenimiento Auto\"] },\r\n            { name: \"Ocio\", type: \"expense\", subs: [\"Suscripciones (Netflix/Spotify)\", \"Cine\", \"Salidas\"] },\r\n            { name: \"Salud\", type: \"expense\", subs: [\"Farmacia\", \"Consultas\", \"Seguro\"] },\r\n        ];\r\n\r\n        for (const def of defaults) {\r\n            // Insert Parent\r\n            const { data: parent, error } = await supabase.from('categories').insert({\r\n                user_id: userId,\r\n                name: def.name,\r\n                type: def.type\r\n            }).select().single();\r\n\r\n            if (parent && !error) {\r\n                // Insert Subcategories\r\n                const subsToInsert = def.subs.map(subName => ({\r\n                    user_id: userId,\r\n                    name: subName,\r\n                    type: def.type,\r\n                    parent_id: parent.id\r\n                }));\r\n                await supabase.from('categories').insert(subsToInsert);\r\n            }\r\n        }\r\n        await fetchCategories();\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (confirm(\"¿Eliminar esta categoría?\")) {\r\n            await supabase.from('categories').delete().eq('id', id);\r\n            fetchCategories();\r\n        }\r\n    };\r\n\r\n    const toggleExpand = (id: string) => {\r\n        setExpanded(prev => ({ ...prev, [id]: !prev[id] }));\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\" onClick={onClose} />\r\n            <div className=\"glass-card w-full max-w-lg p-6 relative animate-in fade-in zoom-in duration-300 border-glow flex flex-col max-h-[85vh]\">\r\n                <div className=\"flex justify-between items-center mb-6 shrink-0\">\r\n                    <h2 className=\"text-xl font-headline font-bold text-white flex items-center gap-2\">\r\n                        <Folder className=\"text-primary-cyan\" /> Gestión de Categorías\r\n                    </h2>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full text-muted-foreground hover:text-white transition\">\r\n                        <X size={20} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Add New */}\r\n                <div className=\"flex flex-col gap-3 mb-6 p-4 rounded-xl bg-white/5 border border-white/10 shrink-0\">\r\n                    <div className=\"flex gap-2\">\r\n                        <input\r\n                            value={newCatName}\r\n                            onChange={e => setNewCatName(e.target.value)}\r\n                            placeholder=\"Nombre de categoría...\"\r\n                            className=\"flex-1 bg-black/40 border border-white/10 rounded-lg px-4 py-2 text-sm focus:border-primary-cyan focus:ring-1 focus:ring-primary-cyan outline-none text-white placeholder:text-muted-foreground\"\r\n                        />\r\n                        <button onClick={handleAdd} disabled={!newCatName.trim()} className=\"bg-primary hover:bg-primary-hover text-white rounded-lg px-4 flex items-center justify-center transition-all shadow-neon disabled:opacity-50\">\r\n                            <Plus />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <select\r\n                        value={selectedParent || \"\"}\r\n                        onChange={e => setSelectedParent(e.target.value === \"\" ? null : e.target.value)}\r\n                        className=\"w-full bg-black/40 border border-white/10 rounded-lg px-4 py-2 text-sm text-muted-foreground outline-none\"\r\n                    >\r\n                        <option value=\"\">-- Sin categoría padre (Raíz) --</option>\r\n                        {categories.map(c => (\r\n                            <option key={c.id} value={c.id}>{c.name}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                {/* List */}\r\n                <div className=\"flex-1 overflow-y-auto pr-2 custom-scrollbar space-y-2 min-h-0\">\r\n                    {loading ? (\r\n                        <p className=\"text-center text-muted-foreground py-4\">Cargando...</p>\r\n                    ) : categories.length === 0 ? (\r\n                        <div className=\"text-center py-8 space-y-4\">\r\n                            <p className=\"text-muted-foreground\">No hay categorías aun.</p>\r\n                            <button onClick={seedDefaults} className=\"px-4 py-2 bg-primary-cyan/20 text-primary-cyan rounded-full border border-primary-cyan/50 hover:bg-primary-cyan/30 flex items-center gap-2 mx-auto transition-all\">\r\n                                <Sparkles size={16} /> Crear Sugeridas\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        categories.map(cat => (\r\n                            <div key={cat.id} className=\"space-y-1\">\r\n                                <div className=\"flex items-center justify-between p-3 rounded-lg bg-card hover:bg-white/5 border border-transparent hover:border-white/10 transition group\">\r\n                                    <div className=\"flex items-center gap-2 text-white flex-1\">\r\n                                        {cat.subcategories && cat.subcategories.length > 0 ? (\r\n                                            <button onClick={() => toggleExpand(cat.id)} className=\"text-muted-foreground hover:text-white p-1\">\r\n                                                {expanded[cat.id] ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\r\n                                            </button>\r\n                                        ) : (\r\n                                            <span className=\"w-6\"></span>\r\n                                        )}\r\n                                        <span className=\"font-medium truncate\">{cat.name}</span>\r\n                                    </div>\r\n                                    <button onClick={() => handleDelete(cat.id)} className=\"opacity-0 group-hover:opacity-100 text-red-500 hover:bg-red-500/10 p-2 rounded transition\">\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                                {/* Subcategories */}\r\n                                {expanded[cat.id] && cat.subcategories?.map(sub => (\r\n                                    <div key={sub.id} className=\"ml-10 flex items-center justify-between p-2 rounded-lg bg-white/5 border border-white/5 text-sm group-sub\">\r\n                                        <span className=\"text-muted-foreground truncate\">{sub.name}</span>\r\n                                        <button onClick={() => handleDelete(sub.id)} className=\"opacity-0 group-sub-hover:opacity-100 text-red-500 hover:text-red-400 transition p-1\">\r\n                                            <Trash2 size={14} />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 489, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/BudgetManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { Target, Save, X, ChevronLeft, ChevronRight, Download } from \"lucide-react\";\r\nimport * as XLSX from 'xlsx';\r\n\r\ntype Budget = {\r\n    id?: string;\r\n    category_id: string;\r\n    amount: number;\r\n    month: string; // YYYY-MM-01\r\n};\r\n\r\nexport default function BudgetManager({ userId, isOpen, onClose }: { userId: string, isOpen: boolean, onClose: () => void }) {\r\n    const [categories, setCategories] = useState<any[]>([]);\r\n    const [budgets, setBudgets] = useState<Record<string, number>>({});\r\n    const [actualSpending, setActualSpending] = useState<Record<string, number>>({});\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Month Navigation\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const currentMonthStr = currentDate.toISOString().slice(0, 7) + '-01'; // YYYY-MM-01 format\r\n\r\n    const supabase = createClient();\r\n\r\n    useEffect(() => {\r\n        if (isOpen) loadData();\r\n    }, [isOpen, currentMonthStr]);\r\n\r\n    const changeMonth = (offset: number) => {\r\n        const newDate = new Date(currentDate);\r\n        newDate.setMonth(newDate.getMonth() + offset);\r\n        setCurrentDate(newDate);\r\n    };\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        const year = currentDate.getFullYear();\r\n        const month = currentDate.getMonth() + 1;\r\n        const currentMonthStr = currentDate.toISOString().slice(0, 7) + '-01';\r\n\r\n        // 1. Fetch Categories\r\n        const { data: catData } = await supabase.from('categories').select('*').eq('user_id', userId).order('name');\r\n        setCategories(catData || []);\r\n\r\n        // 2. Fetch Budgets for this month (Using Integers)\r\n        const { data: budData } = await supabase\r\n            .from('budgets')\r\n            .select('*')\r\n            .eq('user_id', userId)\r\n            .eq('year', year)\r\n            .eq('month', month);\r\n\r\n        const budgetMap: Record<string, number> = {};\r\n        budData?.forEach((b: any) => {\r\n            budgetMap[b.category_id] = b.amount;\r\n        });\r\n        setBudgets(budgetMap);\r\n\r\n        // 3. Calculate Actual Spending (Manual Join Logic to avoid 400 error)\r\n        // Fetch all transactions for this month\r\n        const startOfMonth = currentMonthStr;\r\n        const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).toISOString().slice(0, 10);\r\n\r\n        const { data: txData } = await supabase\r\n            .from('transactions')\r\n            .select('*') // No join\r\n            .eq('user_id', userId)\r\n            .gte('date', startOfMonth)\r\n            .lte('date', endOfMonth);\r\n\r\n        const spendingMap: Record<string, number> = {};\r\n        if (txData) {\r\n            txData.forEach((t: any) => {\r\n                const amount = Number(t.amount);\r\n                // We assume category type from the category list we just fetched\r\n                const cat = catData?.find(c => c.id === t.category_id);\r\n                if (cat) {\r\n                    if (!spendingMap[cat.id]) spendingMap[cat.id] = 0;\r\n                    spendingMap[cat.id] += amount;\r\n                }\r\n            });\r\n        }\r\n        setActualSpending(spendingMap);\r\n\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleSave = async (categoryId: string) => {\r\n        const val = budgets[categoryId];\r\n        // If val is strictly undefined or NaN (empty string parses to NaN), do nothing.\r\n        // User must click the save button to trigger this.\r\n        if (val === undefined || isNaN(val)) return;\r\n\r\n        console.log(`Saving budget for ${categoryId}: ${val}`);\r\n        const year = currentDate.getFullYear();\r\n        const month = currentDate.getMonth() + 1;\r\n\r\n        try {\r\n            // Check if budget exists for this month and category using integers year/month based on actual DB schema\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('budgets')\r\n                .select('id')\r\n                .eq('user_id', userId)\r\n                .eq('category_id', categoryId)\r\n                .eq('year', year)\r\n                .eq('month', month)\r\n                .maybeSingle();\r\n\r\n            if (fetchError) {\r\n                console.error(\"Error checking budget:\", fetchError);\r\n                return;\r\n            }\r\n\r\n            if (existing) {\r\n                // Update\r\n                const { error: updateError } = await supabase\r\n                    .from('budgets')\r\n                    .update({ amount: val })\r\n                    .eq('id', existing.id);\r\n\r\n                if (updateError) console.error(\"Error updating budget:\", updateError);\r\n            } else {\r\n                // Insert\r\n                const { error: insertError } = await supabase\r\n                    .from('budgets')\r\n                    .insert({\r\n                        user_id: userId,\r\n                        category_id: categoryId,\r\n                        amount: val,\r\n                        year: year,\r\n                        month: month,\r\n                        period: 'monthly'\r\n                    });\r\n\r\n                if (insertError) console.error(\"Error creating budget:\", insertError);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Exception saving budget:\", e);\r\n        }\r\n    };\r\n\r\n    const handleExport = () => {\r\n        const dataToExport = categories.map(c => ({\r\n            Categoría: c.name,\r\n            Tipo: c.type === 'income' ? 'Ingreso' : 'Gasto',\r\n            Presupuesto: budgets[c.id] || 0,\r\n            Real: actualSpending[c.id] || 0,\r\n            Diferencia: (budgets[c.id] || 0) - (actualSpending[c.id] || 0)\r\n        }));\r\n\r\n        const ws = XLSX.utils.json_to_sheet(dataToExport);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Presupuesto\");\r\n        XLSX.writeFile(wb, `Sikai_Presupuesto_${currentMonthStr.slice(0, 7)}.xlsx`);\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n            <div className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\" onClick={onClose} />\r\n            <div className=\"glass-card w-full max-w-2xl p-8 relative animate-in fade-in zoom-in duration-300 border-glow h-[85vh] flex flex-col\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h2 className=\"text-xl font-headline font-bold text-white flex items-center gap-2\">\r\n                        <Target className=\"text-pink-500\" /> Presupuesto\r\n                    </h2>\r\n                    <div className=\"flex gap-2\">\r\n                        <button onClick={handleExport} className=\"p-2 bg-white/5 hover:bg-white/10 rounded-full text-muted-foreground hover:text-white transition\" title=\"Exportar\">\r\n                            <Download size={20} />\r\n                        </button>\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full text-muted-foreground hover:text-white transition\">\r\n                            <X size={20} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Month Navigator */}\r\n                <div className=\"flex items-center justify-between bg-white/5 rounded-xl p-3 mb-6 border border-white/5\">\r\n                    <button onClick={() => changeMonth(-1)} className=\"p-2 hover:bg-white/10 rounded-full text-white\"><ChevronLeft /></button>\r\n                    <span className=\"text-lg font-mono font-bold text-white capitalize\">\r\n                        {currentDate.toLocaleString('es-ES', { month: 'long', year: 'numeric' })}\r\n                    </span>\r\n                    <button onClick={() => changeMonth(1)} className=\"p-2 hover:bg-white/10 rounded-full text-white\"><ChevronRight /></button>\r\n                </div>\r\n\r\n                <div className=\"overflow-y-auto flex-1 pr-2 custom-scrollbar space-y-8 min-h-[300px]\">\r\n                    {loading ? (\r\n                        <p className=\"text-center py-10\">Cargando datos del mes...</p>\r\n                    ) : categories.length === 0 ? (\r\n                        <div className=\"flex flex-col items-center justify-center h-full text-center space-y-4\">\r\n                            <p className=\"text-muted-foreground\">No tienes categorías creadas.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            {/* Income Section */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-bold text-primary-cyan uppercase tracking-wider flex items-center gap-2\">\r\n                                    <span className=\"w-2 h-2 rounded-full bg-primary-cyan\"></span> Ingresos Esperados\r\n                                </h3>\r\n                                {categories.filter(c => c.type === 'income').map(cat => {\r\n                                    const budget = budgets[cat.id] || 0;\r\n                                    const actual = actualSpending[cat.id] || 0;\r\n                                    const percent = budget > 0 ? Math.min((actual / budget) * 100, 100) : 0;\r\n\r\n                                    return (\r\n                                        <div key={cat.id} className=\"bg-white/5 p-4 rounded-xl border border-white/5 hover:border-primary-cyan/30 transition-all\">\r\n                                            <div className=\"flex justify-between items-center mb-2\">\r\n                                                <span className=\"font-medium text-white\">{cat.name}</span>\r\n                                                <div className=\"text-right flex items-center gap-2 justify-end\">\r\n                                                    <span className=\"text-xs text-muted-foreground mr-2\">Recibido: ${actual.toLocaleString()}</span>\r\n                                                    <div className=\"flex items-center bg-black/40 rounded border border-white/10 focus-within:border-primary-cyan\">\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={budgets[cat.id] || ''}\r\n                                                            onChange={(e) => {\r\n                                                                const val = parseFloat(e.target.value);\r\n                                                                setBudgets(prev => ({ ...prev, [cat.id]: isNaN(val) ? 0 : val }));\r\n                                                            }}\r\n                                                            placeholder=\"Meta\"\r\n                                                            className=\"w-24 bg-transparent border-none px-2 py-1 text-right font-mono text-sm text-primary-cyan outline-none\"\r\n                                                        />\r\n                                                        <button\r\n                                                            onClick={() => handleSave(cat.id)}\r\n                                                            className=\"p-1.5 hover:bg-primary-cyan/20 text-primary-cyan hover:text-white transition-colors border-l border-white/10\"\r\n                                                            title=\"Guardar\"\r\n                                                        >\r\n                                                            <Save size={14} />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            {/* Progress Bar */}\r\n                                            <div className=\"h-1.5 bg-black/50 rounded-full overflow-hidden\">\r\n                                                <div className=\"h-full bg-primary-cyan transition-all duration-500\" style={{ width: `${percent}%` }} />\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n\r\n                            {/* Expense Section */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-bold text-pink-500 uppercase tracking-wider flex items-center gap-2\">\r\n                                    <span className=\"w-2 h-2 rounded-full bg-pink-500\"></span> Presupuestos de Gastos\r\n                                </h3>\r\n                                {categories.filter(c => c.type === 'expense').map(cat => {\r\n                                    const budget = budgets[cat.id] || 0;\r\n                                    const actual = actualSpending[cat.id] || 0;\r\n\r\n                                    // Visual Logic:\r\n                                    // - If Budget > 0: Normal percent calculation.\r\n                                    // - If Budget = 0 & Actual > 0: Treat as 100% full (red).\r\n                                    // - If Budget = 0 & Actual = 0: 0% empty.\r\n\r\n                                    let percent = 0;\r\n                                    if (budget > 0) {\r\n                                        percent = Math.min((actual / budget) * 100, 100);\r\n                                    } else if (actual > 0) {\r\n                                        percent = 100;\r\n                                    }\r\n\r\n                                    const isOverLimit = (budget > 0 && actual > budget) || (budget === 0 && actual > 0);\r\n\r\n                                    return (\r\n                                        <div key={cat.id} className=\"bg-white/5 p-4 rounded-xl border border-white/5 hover:border-pink-500/30 transition-all\">\r\n                                            <div className=\"flex justify-between items-center mb-2\">\r\n                                                <span className=\"font-medium text-white\">{cat.name}</span>\r\n                                                <div className=\"text-right flex items-center gap-2 justify-end\">\r\n                                                    <span className={`text-xs ${isOverLimit ? 'text-red-500 font-bold' : 'text-muted-foreground'}`}>\r\n                                                        Gastado: ${actual.toLocaleString()}\r\n                                                    </span>\r\n                                                    <div className=\"flex items-center bg-black/40 rounded border border-white/10 focus-within:border-pink-500\">\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={budgets[cat.id] || ''}\r\n                                                            onChange={(e) => {\r\n                                                                const val = parseFloat(e.target.value);\r\n                                                                setBudgets(prev => ({ ...prev, [cat.id]: isNaN(val) ? 0 : val }));\r\n                                                            }}\r\n                                                            placeholder=\"Límite\"\r\n                                                            className={`w-24 bg-transparent border-none px-2 py-1 text-right font-mono text-sm text-pink-500 outline-none`}\r\n                                                        />\r\n                                                        <button\r\n                                                            onClick={() => handleSave(cat.id)}\r\n                                                            className=\"p-1.5 hover:bg-pink-500/20 text-pink-500 hover:text-white transition-colors border-l border-white/10\"\r\n                                                            title=\"Guardar\"\r\n                                                        >\r\n                                                            <Save size={14} />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            {/* Progress Bar */}\r\n                                            <div className=\"h-1.5 bg-black/50 rounded-full overflow-hidden relative\">\r\n                                                <div\r\n                                                    className={`h-full transition-all duration-500 ${isOverLimit ? 'bg-red-500 shadow-[0_0_8px_red]' : 'bg-pink-500'}`}\r\n                                                    style={{ width: `${percent}%` }}\r\n                                                />\r\n                                            </div>\r\n                                            {budget === 0 && actual > 0 && (\r\n                                                <p className=\"text-[10px] text-red-400 mt-1 text-right\">Gasto sin presupuesto asignado.</p>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1081, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/TransactionHistory.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { ArrowDownLeft, ArrowUpRight, Calendar, Search, Trash2, Download } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport * as XLSX from 'xlsx';\r\n\r\ntype Transaction = {\r\n    id: string;\r\n    amount: number;\r\n    note: string;\r\n    date: string;\r\n    categories: {\r\n        name: string;\r\n        type: string;\r\n    };\r\n};\r\n\r\nexport default function TransactionHistory({ userId }: { userId: string }) {\r\n    const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const supabase = createClient();\r\n\r\n    const fetchTransactions = async () => {\r\n        setLoading(true);\r\n\r\n        const { data: txData, error: txError } = await supabase\r\n            .from('transactions')\r\n            .select('*')\r\n            .eq('user_id', userId)\r\n            .order('date', { ascending: false })\r\n            .limit(50);\r\n\r\n        const { data: catData } = await supabase\r\n            .from('categories')\r\n            .select('id, name, type')\r\n            .eq('user_id', userId);\r\n\r\n        if (txData && catData) {\r\n            const joinedData = txData.map((t: any) => ({\r\n                ...t,\r\n                categories: catData.find((c: any) => c.id === t.category_id) || { name: 'Sin categoría', type: 'expense' }\r\n            }));\r\n            // @ts-ignore\r\n            setTransactions(joinedData);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (confirm(\"¿Eliminar transacción?\")) {\r\n            await supabase.from('transactions').delete().eq('id', id);\r\n            fetchTransactions();\r\n        }\r\n    };\r\n\r\n    const handleExport = () => {\r\n        const dataToExport = transactions.map(t => ({\r\n            Fecha: t.date,\r\n            Tipo: t.categories?.type === 'income' ? 'Ingreso' : 'Gasto',\r\n            Monto: t.amount,\r\n            Categoría: t.categories?.name,\r\n            Nota: t.note\r\n        }));\r\n\r\n        const ws = XLSX.utils.json_to_sheet(dataToExport);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Transacciones\");\r\n        XLSX.writeFile(wb, `Sikai_Transacciones_${format(new Date(), 'yyyy-MM-dd')}.xlsx`);\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchTransactions();\r\n\r\n        // Subscribe to changes\r\n        const channel = supabase\r\n            .channel('transactions-history')\r\n            .on('postgres_changes', { event: '*', schema: 'public', table: 'transactions' }, () => {\r\n                fetchTransactions();\r\n            })\r\n            .subscribe();\r\n\r\n        return () => { supabase.removeChannel(channel); };\r\n    }, [userId]);\r\n\r\n    return (\r\n        <div className=\"glass-card p-6 w-full animate-in fade-in slide-in-from-bottom-5 duration-500\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <h3 className=\"text-xl font-headline font-bold text-white flex items-center gap-2\">\r\n                    <Calendar className=\"text-primary-cyan\" /> Historial Reciente\r\n                </h3>\r\n                <button\r\n                    onClick={handleExport}\r\n                    className=\"p-2 bg-white/5 hover:bg-white/10 rounded-full text-muted-foreground hover:text-white transition group\"\r\n                    title=\"Exportar a Excel\"\r\n                >\r\n                    <Download size={20} className=\"group-hover:text-primary-cyan transition-colors\" />\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n                {loading && <p className=\"text-center text-muted-foreground\">Cargando movimientos...</p>}\r\n\r\n                {!loading && transactions.length === 0 && (\r\n                    <p className=\"text-center text-muted-foreground py-8\">No hay transacciones registradas.</p>\r\n                )}\r\n\r\n                {transactions.map((t) => (\r\n                    <div key={t.id} className=\"flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/5 hover:border-white/20 transition-all group\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className={`p-3 rounded-full ${t.categories?.type === 'income' ? 'bg-primary-cyan/20 text-primary-cyan' : 'bg-pink-500/20 text-pink-500'}`}>\r\n                                {t.categories?.type === 'income' ? <ArrowUpRight size={20} /> : <ArrowDownLeft size={20} />}\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-white font-medium\">{t.note || 'Sin nota'}</p>\r\n                                <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                                    <span className=\"bg-white/10 px-2 py-0.5 rounded text-white/70\">{t.categories?.name}</span>\r\n                                    <span>•</span>\r\n                                    <span>{format(new Date(t.date), \"d MMM yyyy\", { locale: es })}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <span className={`font-mono font-bold text-lg ${t.categories?.type === 'income' ? 'text-primary-cyan' : 'text-white'}`}>\r\n                                {t.categories?.type === 'income' ? '+' : '-'} ${Math.abs(t.amount).toLocaleString()}\r\n                            </span>\r\n                            <button onClick={() => handleDelete(t.id)} className=\"opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-red-500 transition\">\r\n                                <Trash2 size={18} />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAPA;;;;;;;;AAoBe,SAAS,mBAAmB,EAAE,MAAM,EAAsB;IACrE,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB,EAAE;IAClE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,WAAW,IAAA,2IAAY;IAE7B,MAAM,oBAAoB;QACtB,WAAW;QAEX,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,QAAQ;YAAE,WAAW;QAAM,GACjC,KAAK,CAAC;QAEX,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,kBACP,EAAE,CAAC,WAAW;QAEnB,IAAI,UAAU,SAAS;YACnB,MAAM,aAAa,OAAO,GAAG,CAAC,CAAC,IAAW,CAAC;oBACvC,GAAG,CAAC;oBACJ,YAAY,QAAQ,IAAI,CAAC,CAAC,IAAW,EAAE,EAAE,KAAK,EAAE,WAAW,KAAK;wBAAE,MAAM;wBAAiB,MAAM;oBAAU;gBAC7G,CAAC;YACD,aAAa;YACb,gBAAgB;QACpB;QACA,WAAW;IACf;IAEA,MAAM,eAAe,OAAO;QACxB,IAAI,QAAQ,2BAA2B;YACnC,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,GAAG,EAAE,CAAC,MAAM;YACtD;QACJ;IACJ;IAEA,MAAM,eAAe;QACjB,MAAM,eAAe,aAAa,GAAG,CAAC,CAAA,IAAK,CAAC;gBACxC,OAAO,EAAE,IAAI;gBACb,MAAM,EAAE,UAAU,EAAE,SAAS,WAAW,YAAY;gBACpD,OAAO,EAAE,MAAM;gBACf,WAAW,EAAE,UAAU,EAAE;gBACzB,MAAM,EAAE,IAAI;YAChB,CAAC;QAED,MAAM,KAAK,sIAAU,CAAC,aAAa,CAAC;QACpC,MAAM,KAAK,sIAAU,CAAC,QAAQ;QAC9B,sIAAU,CAAC,iBAAiB,CAAC,IAAI,IAAI;QACrC,0IAAc,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAA,+JAAM,EAAC,IAAI,QAAQ,cAAc,KAAK,CAAC;IACrF;IAEA,IAAA,kNAAS,EAAC;QACN;QAEA,uBAAuB;QACvB,MAAM,UAAU,SACX,OAAO,CAAC,wBACR,EAAE,CAAC,oBAAoB;YAAE,OAAO;YAAK,QAAQ;YAAU,OAAO;QAAe,GAAG;YAC7E;QACJ,GACC,SAAS;QAEd,OAAO;YAAQ,SAAS,aAAa,CAAC;QAAU;IACpD,GAAG;QAAC;KAAO;IAEX,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;;0CACV,8OAAC,sNAAQ;gCAAC,WAAU;;;;;;4BAAsB;;;;;;;kCAE9C,8OAAC;wBACG,SAAS;wBACT,WAAU;wBACV,OAAM;kCAEN,cAAA,8OAAC,sNAAQ;4BAAC,MAAM;4BAAI,WAAU;;;;;;;;;;;;;;;;;0BAItC,8OAAC;gBAAI,WAAU;;oBACV,yBAAW,8OAAC;wBAAE,WAAU;kCAAoC;;;;;;oBAE5D,CAAC,WAAW,aAAa,MAAM,KAAK,mBACjC,8OAAC;wBAAE,WAAU;kCAAyC;;;;;;oBAGzD,aAAa,GAAG,CAAC,CAAC,kBACf,8OAAC;4BAAe,WAAU;;8CACtB,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAW,CAAC,iBAAiB,EAAE,EAAE,UAAU,EAAE,SAAS,WAAW,yCAAyC,gCAAgC;sDAC1I,EAAE,UAAU,EAAE,SAAS,yBAAW,8OAAC,0OAAY;gDAAC,MAAM;;;;;qEAAS,8OAAC,6OAAa;gDAAC,MAAM;;;;;;;;;;;sDAEzF,8OAAC;;8DACG,8OAAC;oDAAE,WAAU;8DAA0B,EAAE,IAAI,IAAI;;;;;;8DACjD,8OAAC;oDAAI,WAAU;;sEACX,8OAAC;4DAAK,WAAU;sEAAiD,EAAE,UAAU,EAAE;;;;;;sEAC/E,8OAAC;sEAAK;;;;;;sEACN,8OAAC;sEAAM,IAAA,+JAAM,EAAC,IAAI,KAAK,EAAE,IAAI,GAAG,cAAc;gEAAE,QAAQ,iJAAE;4DAAC;;;;;;;;;;;;;;;;;;;;;;;;8CAIvE,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAK,WAAW,CAAC,4BAA4B,EAAE,EAAE,UAAU,EAAE,SAAS,WAAW,sBAAsB,cAAc;;gDACjH,EAAE,UAAU,EAAE,SAAS,WAAW,MAAM;gDAAI;gDAAG,KAAK,GAAG,CAAC,EAAE,MAAM,EAAE,cAAc;;;;;;;sDAErF,8OAAC;4CAAO,SAAS,IAAM,aAAa,EAAE,EAAE;4CAAG,WAAU;sDACjD,cAAA,8OAAC,oNAAM;gDAAC,MAAM;;;;;;;;;;;;;;;;;;2BAnBhB,EAAE,EAAE;;;;;;;;;;;;;;;;;AA2BlC"}},
    {"offset": {"line": 1367, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/Dashboard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { PieChart, Pie, Cell, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid } from \"recharts\";\r\nimport { ArrowUpRight, ArrowDownRight, Wallet, Target, Layers, Calendar } from \"lucide-react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { clsx } from \"clsx\";\r\nimport CategoryManager from \"./CategoryManager\";\r\nimport BudgetManager from \"./BudgetManager\";\r\nimport TransactionHistory from \"./TransactionHistory\";\r\n\r\nexport default function Dashboard({ userId }: { userId: string }) {\r\n    const [balance, setBalance] = useState(0);\r\n    const [income, setIncome] = useState(0);\r\n    const [expense, setExpense] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n    const [timeFilter, setTimeFilter] = useState<'month' | 'year'>('month');\r\n\r\n    // Modal States\r\n    const [showCategories, setShowCategories] = useState(false);\r\n    const [showBudget, setShowBudget] = useState(false);\r\n\r\n    // Chart Data\r\n    const [pieData, setPieData] = useState<any[]>([]);\r\n    const [barData, setBarData] = useState<any[]>([]);\r\n\r\n    const supabase = createClient();\r\n\r\n    // Function to refresh all data - pass this to children if they modify data\r\n    const refreshData = async () => {\r\n        setLoading(true);\r\n\r\n        // 1. Fetch Transactions\r\n        const { data: transactions } = await supabase\r\n            .from('transactions')\r\n            .select('*')\r\n            .eq('user_id', userId);\r\n\r\n        // 2. Fetch Categories\r\n        const { data: categories } = await supabase\r\n            .from('categories')\r\n            .select('id, name, type')\r\n            .eq('user_id', userId);\r\n\r\n        if (transactions && categories) {\r\n            let totalInc = 0;\r\n            let totalExp = 0;\r\n            const categoryMap: Record<string, number> = {};\r\n            const timeMap: Record<string, { inc: number, exp: number }> = {};\r\n\r\n            transactions.forEach((t: any) => {\r\n                const val = Number(t.amount);\r\n\r\n                // Manual Join\r\n                const category = categories.find((c: any) => c.id === t.category_id);\r\n                const type = category?.type || 'expense';\r\n                const catName = category?.name || 'Otro';\r\n\r\n                if (type === 'income') {\r\n                    totalInc += val;\r\n                } else {\r\n                    totalExp += val;\r\n                    // For Pie Chart (Gastos por Categoría)\r\n                    categoryMap[catName] = (categoryMap[catName] || 0) + val;\r\n                }\r\n\r\n                // For Bar Chart (Time based)\r\n                const date = new Date(t.date);\r\n                const key = timeFilter === 'month'\r\n                    ? `Sem ${Math.ceil(date.getDate() / 7)}` // Weekly grouping\r\n                    : date.toLocaleString('default', { month: 'short' }); // Monthly grouping\r\n\r\n                if (!timeMap[key]) timeMap[key] = { inc: 0, exp: 0 };\r\n                if (type === 'income') timeMap[key].inc += val;\r\n                else timeMap[key].exp += val;\r\n            });\r\n\r\n            setIncome(totalInc);\r\n            setExpense(totalExp);\r\n            setBalance(totalInc - totalExp);\r\n\r\n            // Transform Maps to Arrays for Charts\r\n            const pie = Object.keys(categoryMap).map(k => ({ name: k, value: categoryMap[k] }));\r\n            setPieData(pie);\r\n\r\n            const bar = Object.keys(timeMap).map(k => ({ name: k, ...timeMap[k] }));\r\n            setBarData(bar);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        refreshData();\r\n\r\n        // Realtime subscription for Dashboard Numbers\r\n        const channel = supabase\r\n            .channel('dashboard-realtime')\r\n            .on('postgres_changes', { event: '*', schema: 'public', table: 'transactions' }, () => {\r\n                refreshData();\r\n            })\r\n            .subscribe();\r\n\r\n        return () => { supabase.removeChannel(channel); };\r\n    }, [userId, timeFilter]);\r\n\r\n    const handleLogout = async () => {\r\n        await supabase.auth.signOut();\r\n        window.location.href = '/login';\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center min-h-screen bg-black text-white\">\r\n            <div className=\"animate-pulse text-2xl font-bold font-headline tracking-widest uppercase\">\r\n                Cargando Sikai...\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-black bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-gray-900 via-black to-black pb-24 md:pb-10\">\r\n\r\n            {/* Header / Nav */}\r\n            <nav className=\"border-b border-white/10 sticky top-0 z-50 backdrop-blur-md bg-black/50\">\r\n                <div className=\"max-w-7xl mx-auto px-4 md:px-8 h-16 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Wallet className=\"text-primary h-8 w-8\" />\r\n                        <h1 className=\"text-2xl font-bold font-headline tracking-tight text-white hidden md:block\">\r\n                            SIKAI <span className=\"text-primary\">FINANCE</span>\r\n                        </h1>\r\n                    </div>\r\n\r\n                    {/* User Profile / Menu */}\r\n                    <div className=\"relative group\">\r\n                        <button className=\"h-9 w-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 border border-white/20 flex items-center justify-center text-white text-xs font-bold hover:scale-105 transition-transform shadow-lg shadow-indigo-500/20\">\r\n                            MS\r\n                        </button>\r\n\r\n                        {/* Dropdown */}\r\n                        <div className=\"absolute right-0 top-full mt-2 w-48 bg-black/90 border border-white/10 rounded-xl shadow-2xl p-1 opacity-0 group-hover:opacity-100 invisible group-hover:visible transition-all duration-200 transform origin-top-right z-50\">\r\n                            <button\r\n                                onClick={handleLogout}\r\n                                className=\"w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-white/5 rounded-lg transition-colors flex items-center gap-2\"\r\n                            >\r\n                                <span className=\"w-2 h-2 rounded-full bg-red-500\"></span> Cerrar Sesión\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            <div className=\"p-4 space-y-8 pb-32 max-w-7xl mx-auto\">\r\n\r\n                {/* Time Filter Tabs */}\r\n                <div className=\"flex justify-center mb-6\">\r\n                    <div className=\"bg-muted/30 p-1 rounded-full border border-glass-border backdrop-blur-md flex\">\r\n                        <button\r\n                            onClick={() => setTimeFilter('month')}\r\n                            className={clsx(\"px-6 py-2 rounded-full text-sm font-medium transition-all duration-300\", timeFilter === 'month' ? \"bg-primary text-white shadow-neon\" : \"text-muted-foreground hover:text-white\")}\r\n                        >\r\n                            Mensual\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setTimeFilter('year')}\r\n                            className={clsx(\"px-6 py-2 rounded-full text-sm font-medium transition-all duration-300\", timeFilter === 'year' ? \"bg-primary text-white shadow-neon\" : \"text-muted-foreground hover:text-white\")}\r\n                        >\r\n                            Anual\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Hero Stats */}\r\n                <section className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                    {/* Main Balance */}\r\n                    <div className=\"glass-card p-8 relative overflow-hidden group\">\r\n                        <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                            <Wallet size={120} />\r\n                        </div>\r\n                        <div className=\"relative z-10\">\r\n                            <h3 className=\"text-muted-foreground font-medium flex items-center gap-2 mb-2\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-primary-cyan animate-pulse\"></span>\r\n                                Saldo Disponible\r\n                            </h3>\r\n                            <p className=\"text-5xl font-bold font-mono text-white text-glow tracking-tighter\">\r\n                                {loading ? \"...\" : `$ ${balance.toLocaleString()}`}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Income */}\r\n                    <div className=\"glass-card p-6 flex flex-col justify-center\">\r\n                        <p className=\"text-muted-foreground text-sm flex items-center gap-2 mb-1\">\r\n                            <ArrowUpRight size={16} className=\"text-primary-cyan\" /> Ingresos\r\n                        </p>\r\n                        <p className=\"text-3xl font-bold font-mono text-white neon-text-cyan\">\r\n                            $ {income.toLocaleString()}\r\n                        </p>\r\n                        <div className=\"w-full bg-muted/50 h-1 mt-4 rounded-full overflow-hidden\">\r\n                            <div\r\n                                className=\"bg-primary-cyan h-full shadow-[0_0_10px_#26d8c4] transition-all duration-1000\"\r\n                                style={{ width: `${Math.min((income / (income + expense || 1)) * 100, 100)}%` }}\r\n                            ></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Expense */}\r\n                    <div className=\"glass-card p-6 flex flex-col justify-center\">\r\n                        <p className=\"text-muted-foreground text-sm flex items-center gap-2 mb-1\">\r\n                            <ArrowDownRight size={16} className=\"text-pink-500\" /> Gastos\r\n                        </p>\r\n                        <p className=\"text-3xl font-bold font-mono text-white\" style={{ textShadow: \"0 0 10px rgba(236, 72, 153, 0.5)\" }}>\r\n                            $ {expense.toLocaleString()}\r\n                        </p>\r\n                        <div className=\"w-full bg-muted/50 h-1 mt-4 rounded-full overflow-hidden\">\r\n                            <div\r\n                                className=\"bg-pink-500 h-full shadow-[0_0_10px_#ec4899] transition-all duration-1000\"\r\n                                style={{ width: `${Math.min((expense / (income + expense || 1)) * 100, 100)}%` }}\r\n                            ></div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Analytics Grid */}\r\n                <section className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n\r\n                    {/* Pie Chart */}\r\n                    <div className=\"glass-card p-6 lg:col-span-1 flex flex-col items-center justify-center relative min-h-[300px]\">\r\n                        <h3 className=\"text-lg font-headline font-semibold mb-2 w-full text-left flex items-center gap-2\">\r\n                            <Target size={18} className=\"text-primary\" /> Gastos por Categoría\r\n                        </h3>\r\n                        <div className=\"h-64 w-full relative\">\r\n                            {pieData.length > 0 ? (\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <PieChart>\r\n                                        <Pie\r\n                                            data={pieData}\r\n                                            cx=\"50%\"\r\n                                            cy=\"50%\"\r\n                                            innerRadius={60}\r\n                                            outerRadius={80}\r\n                                            paddingAngle={5}\r\n                                            dataKey=\"value\"\r\n                                            stroke=\"none\"\r\n                                        >\r\n                                            {pieData.map((entry, index) => (\r\n                                                <Cell key={`cell-${index}`} fill={['#ec4899', '#26d8c4', '#1a88ff', '#facc15'][index % 4]} />\r\n                                            ))}\r\n                                        </Pie>\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#000', borderRadius: '8px', border: '1px solid #333' }}\r\n                                            itemStyle={{ color: '#fff' }}\r\n                                        />\r\n                                    </PieChart>\r\n                                </ResponsiveContainer>\r\n                            ) : (\r\n                                <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">Sin datos aún</div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Bar Chart */}\r\n                    <div className=\"glass-card p-6 lg:col-span-2 min-h-[300px]\">\r\n                        <h3 className=\"text-lg font-headline font-semibold mb-6 flex items-center gap-2\">\r\n                            <Calendar size={18} className=\"text-primary\" /> Flujo Financiero\r\n                        </h3>\r\n                        <div className=\"h-64 cursor-crosshair\">\r\n                            {barData.length > 0 ? (\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <BarChart data={barData}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"rgba(255,255,255,0.05)\" />\r\n                                        <XAxis dataKey=\"name\" stroke=\"#4b5563\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                        <YAxis stroke=\"#4b5563\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value / 1000}k`} />\r\n                                        <Tooltip\r\n                                            cursor={{ fill: 'rgba(255,255,255,0.03)' }}\r\n                                            contentStyle={{ backgroundColor: '#000', borderColor: '#333' }}\r\n                                        />\r\n                                        <Bar dataKey=\"inc\" fill=\"#26d8c4\" radius={[4, 4, 0, 0]} maxBarSize={40} name=\"Ingresos\" />\r\n                                        <Bar dataKey=\"exp\" fill=\"#ec4899\" radius={[4, 4, 0, 0]} maxBarSize={40} name=\"Gastos\" />\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            ) : (\r\n                                <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">Registra transacciones para ver el gráfico</div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Transaction History Section (New) */}\r\n                <section>\r\n                    <TransactionHistory userId={userId} />\r\n                </section>\r\n\r\n                {/* Feature Access Grid */}\r\n                <section className=\"grid grid-cols-2 gap-4\">\r\n                    <button onClick={() => setShowBudget(true)} className=\"glass-card p-4 flex flex-col items-center justify-center gap-2 hover:bg-primary/10 group\">\r\n                        <div className=\"p-3 rounded-full bg-primary/10 text-primary group-hover:shadow-neon transition-all\">\r\n                            <Target size={24} />\r\n                        </div>\r\n                        <span className=\"text-sm font-medium\">Nuevo Presupuesto</span>\r\n                    </button>\r\n                    <button onClick={() => setShowCategories(true)} className=\"glass-card p-4 flex flex-col items-center justify-center gap-2 hover:bg-primary/10 group\">\r\n                        <div className=\"p-3 rounded-full bg-primary/10 text-primary-cyan group-hover:shadow-neon-cyan transition-all\">\r\n                            <Layers size={24} />\r\n                        </div>\r\n                        <span className=\"text-sm font-medium\">Categorías</span>\r\n                    </button>\r\n                </section>\r\n\r\n                {/* Modals */}\r\n                <CategoryManager isOpen={showCategories} onClose={() => setShowCategories(false)} userId={userId} />\r\n                <BudgetManager isOpen={showBudget} onClose={() => setShowBudget(false)} userId={userId} />\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/TransactionForm.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { X, Check, DollarSign, Tag, ChevronRight } from \"lucide-react\";\r\n\r\nexport default function TransactionForm({ onClose, onSuccess, userId }: { onClose: () => void, onSuccess: () => void, userId: string }) {\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [note, setNote] = useState(\"\");\r\n    const [date, setDate] = useState(new Date().toISOString().slice(0, 10));\r\n\r\n    // Category Logic\r\n    const [categories, setCategories] = useState<any[]>([]);\r\n    const [selectedParentId, setSelectedParentId] = useState<string>(\"\");\r\n    const [selectedSubId, setSelectedSubId] = useState<string>(\"\");\r\n\r\n    const [loading, setLoading] = useState(false);\r\n    const supabase = createClient();\r\n\r\n    useEffect(() => {\r\n        const fetchCats = async () => {\r\n            const { data } = await supabase.from('categories').select('*').eq('user_id', userId).order('name');\r\n            if (data) setCategories(data);\r\n        };\r\n        fetchCats();\r\n    }, [userId]);\r\n\r\n    // Derive parents and subs\r\n    const parents = categories.filter(c => !c.parent_id);\r\n    const subs = selectedParentId ? categories.filter(c => c.parent_id === selectedParentId) : [];\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        // If subcategory selected, use that. If not, use parent.\r\n        const finalCategoryId = selectedSubId || selectedParentId;\r\n\r\n        if (!finalCategoryId) {\r\n            alert(\"Por favor selecciona una categoría.\");\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const { error } = await supabase.from('transactions').insert({\r\n            user_id: userId,\r\n            amount: parseFloat(amount),\r\n            note,\r\n            date,\r\n            category_id: finalCategoryId\r\n        });\r\n\r\n        if (!error) {\r\n            onSuccess();\r\n            onClose();\r\n        } else {\r\n            console.error(error);\r\n            alert(\"Error al guardar.\");\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col\">\r\n            <div className=\"flex items-center justify-between p-6 border-b border-white/10 bg-black/20 backdrop-blur-md\">\r\n                <h2 className=\"text-2xl font-headline font-bold text-white\">Nueva Transacción</h2>\r\n                <button onClick={onClose} className=\"text-muted-foreground hover:text-white transition\">\r\n                    <X size={24} />\r\n                </button>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"flex-1 p-6 space-y-6 overflow-y-auto custom-scrollbar\">\r\n\r\n                {/* Amount */}\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-sm text-muted-foreground font-medium flex items-center gap-2\">\r\n                        <DollarSign size={14} className=\"text-primary\" /> Monto\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-2xl text-white font-mono\">$</span>\r\n                        <input\r\n                            type=\"number\"\r\n                            required\r\n                            value={amount}\r\n                            onChange={e => setAmount(e.target.value)}\r\n                            className=\"w-full bg-black/40 border-2 border-white/10 rounded-2xl py-4 pl-10 pr-4 text-3xl font-mono text-white placeholder:text-muted-foreground focus:border-primary focus:shadow-neon outline-none transition-all\"\r\n                            placeholder=\"0.00\"\r\n                            autoFocus\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Category Selection */}\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm text-muted-foreground font-medium flex items-center gap-2\">\r\n                            <Tag size={14} className=\"text-primary-cyan\" /> Categoría Principal\r\n                        </label>\r\n                        <select\r\n                            required\r\n                            value={selectedParentId}\r\n                            onChange={e => {\r\n                                setSelectedParentId(e.target.value);\r\n                                setSelectedSubId(\"\"); // Reset sub on parent change\r\n                            }}\r\n                            className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-primary-cyan transition-all outline-none appearance-none\"\r\n                        >\r\n                            <option value=\"\" className=\"text-black bg-white\">-- Seleccionar --</option>\r\n                            {parents.map(c => (\r\n                                <option key={c.id} value={c.id} className=\"text-black bg-white\">\r\n                                    {c.name} ({c.type === 'income' ? 'Ingreso' : 'Gasto'})\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n\r\n                    {/* Subcategories (Conditional) */}\r\n                    {selectedParentId && subs.length > 0 && (\r\n                        <div className=\"space-y-2 animate-in fade-in slide-in-from-top-2\">\r\n                            <label className=\"text-sm text-muted-foreground font-medium flex items-center gap-2 pl-4 border-l-2 border-white/10\">\r\n                                <ChevronRight size={14} /> Subcategoría (Opcional)\r\n                            </label>\r\n                            <select\r\n                                value={selectedSubId}\r\n                                onChange={e => setSelectedSubId(e.target.value)}\r\n                                className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-primary-cyan transition-all outline-none appearance-none\"\r\n                            >\r\n                                <option value=\"\" className=\"text-black bg-white\">-- General --</option>\r\n                                {subs.map(c => (\r\n                                    <option key={c.id} value={c.id} className=\"text-black bg-white\">\r\n                                        {c.name}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Date & Desc */}\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm text-muted-foreground font-medium\">Fecha</label>\r\n                        <input\r\n                            type=\"date\"\r\n                            required\r\n                            value={date}\r\n                            onChange={e => setDate(e.target.value)}\r\n                            className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-primary outline-none\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm text-muted-foreground font-medium\">Nota</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={note}\r\n                            onChange={e => setNote(e.target.value)}\r\n                            placeholder=\"Detalle...\"\r\n                            className=\"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-primary outline-none\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n            </form>\r\n\r\n            <div className=\"p-6 border-t border-white/10 bg-black/20 backdrop-blur-md\">\r\n                <button\r\n                    onClick={handleSubmit}\r\n                    disabled={loading}\r\n                    className=\"w-full bg-gradient-to-r from-primary to-primary-hover text-white font-bold py-4 rounded-xl shadow-neon hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                    {loading ? \"Guardando...\" : <><Check /> Guardar Transacción</>}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2578, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mayko/.gemini/antigravity/scratch/sikai-finance/components/AddTransactionButton.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Plus } from \"lucide-react\";\r\nimport TransactionForm from \"@/components/TransactionForm\";\r\n\r\nexport default function AddTransactionButton({ userId }: { userId: string }) {\r\n    const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n\r\n    return (\r\n        <>\r\n            <button\r\n                onClick={() => setIsDrawerOpen(true)}\r\n                className=\"fixed bottom-6 right-6 h-14 w-14 rounded-full bg-primary text-primary-foreground shadow-lg shadow-primary/30 flex items-center justify-center hover:scale-110 transition-transform active:scale-95 z-40\"\r\n            >\r\n                <Plus size={32} />\r\n            </button>\r\n\r\n            {isDrawerOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\r\n                    <div className=\"w-full max-w-md h-[80vh] bg-background/95 backdrop-blur-xl border border-white/10 rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95 duration-200 slide-in-from-bottom-5\">\r\n                        <TransactionForm\r\n                            onClose={() => setIsDrawerOpen(false)}\r\n                            onSuccess={() => setIsDrawerOpen(false)}\r\n                            userId={userId}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,qBAAqB,EAAE,MAAM,EAAsB;IACvE,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,qBACI;;0BACI,8OAAC;gBACG,SAAS,IAAM,gBAAgB;gBAC/B,WAAU;0BAEV,cAAA,8OAAC,0MAAI;oBAAC,MAAM;;;;;;;;;;;YAGf,8BACG,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC,yIAAe;wBACZ,SAAS,IAAM,gBAAgB;wBAC/B,WAAW,IAAM,gBAAgB;wBACjC,QAAQ;;;;;;;;;;;;;;;;;;AAOpC"}}]
}